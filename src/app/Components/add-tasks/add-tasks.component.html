<div class="add-task-container container">
  <h2>Agregar Tarea</h2>

  <!-- TÃ­tulo (requerido) -->
  <label for="title">TÃ­tulo (Actividad o Materia) *:</label>
  <input
    id="title"
    [(ngModel)]="title"
    placeholder="TÃ­tulo de la tarea"
    [class.error]="titleError"
    (blur)="validateTitle()"
  />
  <div *ngIf="titleError" class="error-message">{{ titleError }}</div>

  <!-- DescripciÃ³n (opcional) -->
  <label for="description">DescripciÃ³n:</label>
  <textarea
    id="description"
    [(ngModel)]="description"
    placeholder="DescripciÃ³n de la tarea (opcional)"
  ></textarea>

  <!-- Tipo de tarea -->
  <label for="type">Tipo *:</label>
  <select id="type" [(ngModel)]="type">
    <option value="house">Tarea del Hogar</option>
    <option value="school">Deber Escolar</option>
  </select>

  <!-- Solo para deberes: materia -->
  <div *ngIf="type === 'school'">
    <label for="subject">Materia *:</label>
    <input
      id="subject"
      [(ngModel)]="subject"
      placeholder="Materia"
      [class.error]="subjectError"
      (blur)="validateSubject()"
    />
    <div *ngIf="subjectError" class="error-message">{{ subjectError }}</div>
  </div>

  <!-- BotÃ³nâ€‘switch: tarea diaria -->
  <div class="toggle-container">
    <button
      type="button"
      class="toggle-btn"
      [class.active]="isDaily"
      (click)="toggleDaily()"
    >
      {{ isDaily ? 'âœ… Tarea Diaria Activada' : 'ðŸ•“ Tarea Diaria Desactivada' }}
    </button>
  </div>

  <!-- Fecha y hora lÃ­mite (solo si NO es diaria) -->
  <div *ngIf="!isDaily" class="field-enter">
    <label for="dueDate">Fecha LÃ­mite *:</label>
    <input
      type="date"
      id="dueDate"
      [(ngModel)]="dueDate"
      [class.error]="dueDateError"
      (blur)="validateDueDate()"
    />
    <div *ngIf="dueDateError" class="error-message">{{ dueDateError }}</div>

    <label for="dueTime">Hora LÃ­mite:</label>
    <input
      type="time"
      id="dueTime"
      [(ngModel)]="dueTime"
      [class.error]="dueTimeError"
      (blur)="validateDueTime()"
    />
    <div *ngIf="dueTimeError" class="error-message">{{ dueTimeError }}</div>
  </div>

  <!-- SecciÃ³n de notificaciones -->
  <div class="notification-section">
    <h3>Notificaciones</h3>

    <!-- BotÃ³nâ€‘switch: habilitar notificaciones -->
    <div class="toggle-container">
      <button
        type="button"
        class="toggle-btn"
        [class.active]="notificationEnabled"
        (click)="toggleNotification()"
      >
        {{
          notificationEnabled
            ? 'ðŸ”” Notificaciones Activadas'
            : 'ðŸ”• Notificaciones Desactivadas'
        }}
      </button>
    </div>

    <!-- Hora de notificaciÃ³n -->
    <div *ngIf="notificationEnabled" class="field-enter">
      <label for="notificationTime">Hora de notificaciÃ³n *:</label>
      <input
        type="time"
        id="notificationTime"
        [(ngModel)]="notificationTime"
        [class.error]="notificationTimeError"
        (blur)="validateNotificationTime()"
      />
      <div
        *ngIf="notificationTimeError"
        class="error-message"
      >
        {{ notificationTimeError }}
      </div>
      <small class="help-text">
        {{
          isDaily
            ? 'RecibirÃ¡s una notificaciÃ³n diaria a esta hora'
            : 'RecibirÃ¡s una notificaciÃ³n en la fecha y hora especificadas'
        }}
      </small>
    </div>

    <!-- Advertencia de permisos -->
    <div
      *ngIf="notificationEnabled && !notificationPermission"
      class="warning-message"
    >
      <strong>Importante:</strong> Necesitas otorgar permisos de notificaciÃ³n
      para recibir recordatorios.
    </div>
  </div>

  <!-- BotÃ³n para foto (opcional) -->
  <button type="button" (click)="takePhoto()" class="camera-btn">
    ðŸ“· Tomar Foto
  </button>
  <div *ngIf="photo" class="photo-preview">
    <img [src]="photo" alt="Foto tomada" class="preview-image" />
  </div>

  <!-- Mensajes de error generales -->
  <div *ngIf="generalError" class="error-message general-error">
    {{ generalError }}
  </div>

  <!-- Botones de acciÃ³n -->
  <button (click)="saveTask()" class="submit-btn" [disabled]="isSaving">
    {{ isSaving ? 'Guardando...' : 'Guardar Tarea' }}
  </button>
  <button routerLink="/tasks-list" class="cancel-btn">Cancelar</button>
</div>
